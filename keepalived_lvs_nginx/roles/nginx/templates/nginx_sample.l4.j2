{% if prot == 'UDP' %}
upstream {{ vip }}_{{ vport }}_udp {
{% else %}
upstream {{ vip }}_{{ vport }}_tcp {
{% endif %}
	hash $remote_addr consistent;
	{% for item in rslist -%}
	server {{ item.ip }}:{{ item.port }} max_fails=3 fail_timeout=30s;
	{% endfor %}
}
server {
{% if prot == 'UDP' %}
	listen	{{ vip }}:{{ vport }} udp;
{% else %}
	listen	{{ vip }}:{{ vport }};
{% endif %}
	proxy_connect_timeout 60s;
	proxy_timeout 10m;
	proxy_pass {{ vip }}_{{ vport }}_{{ prot }};
}
